---
title: A deep dive into Docker
image: docker.png
img_path: /images/
date: 2023-09-02
categories: [development]
tags: [docker,containers,devops]
pin: false
comments: true
---

Docker is a great straight forward way of using containerization. I'm a big fan, and use Docker to pretty much use Docker to run most of my lab. 

Refer to the Table of Contents if you are looking for something specific about Docker.

## What is Docker?

The brand Docker has become synonymous with containers very much like Kleenex to tissues. The reason for Docker's popularity is it takes the concept of containerization and makes it simple, easy to use, and quick to deploy. While this overall Docker guide isn't meant to be an explanation of containers in general, it's important to pause a brief moment and highlight what we're talking about.

Physical computers came first and one or several applications ran on them. Next came virtual machines, which virtualize physical hardware by using a hypervisor. Virtual machines require a 'guest os' to be run beneath them. This guest OS represents the profile of the virtual hardware and dependencies needed to run the operating system. Finally we have containers, which virtualize the operating system itself. This makes containers extremely light-weight as they don't spin up an entirely new virtual server through a guest OS. Containers utilize the underlying kernel or host OS directly in order to create hosts that are designed to be the bare minimum necessary to support a single application. Containers specify an operating system and include just the dependencies and libraries needed within that OS to get the job done.

If further understanding of virtualization is necessary this video goes into good concepts of not only what VMs and containers are but how the need for them developed. This need is first and foremost resource utilization.

<iframe style="display: block; margin: auto;" width="600" height="400" src="https://www.youtube-nocookie.com/embed/EYOGh2rK-h8?si=BB3N3iJFUvFE3mRA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## Setup

> This is a How-to guide on setting up Docker on Ubuntu Linux. 
{: .prompt-info }

These commands are taken directly from Docker documentation and explained for your convenience.

1. Uninstall old docker versions to start fresh

    ```bash
    sudo apt-get remove docker docker-engine docker.io containerd runc
    ```
    {: .nolineno }

2. Add Docker’s GPG key to your machine. This acts as a signature for the docker repo and lets your machine know to trust it. It also provides encryption during the file transfer process.    

    ```bash
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
    ```
    {: .nolineno }

3. Next, use the following series of commands to send a script block to the terminal which points to the public GPG key that is now on the machine and tells the apt package manager to include the docker repository as a 3rd party trusted repo. 

    ```bash
    echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
      $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
    {: .nolineno }

4. Update the apt package index to include the new docker repo and install docker along with its engine and docker compose.

    ```bash
    sudo apt update
    ```
    {: .nolineno }
    ```bash
    sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
    ```
    {: .nolineno }

5. Verify docker is working as intended by running the test docker image.

    ```bash
    sudo docker run hello-world
    ```
    {: .nolineno }

6. Add your current logged in user to the Docker linux group which has permissions equivalent to root for editing file systems for your containers. (If this group is missing you can use sudo groupadd docker)

    ```bash
    sudo usermod -aG docker $USER
    ```
    {: .nolineno }

7. You can verify it worked by logging back in using “su - username” then trying to run docker without sudo now.

    ```bash
    docker run hello-world
    ```
    {: .nolineno }

8. On ubuntu Docker is added to start automatically but on other distributions you may need to use systemd the default system manager of most linux machines.

    ```bash
    sudo systemctl enable docker.service
    ```
    {: .nolineno }

    ```bash
    sudo systemctl enable containerd.service
    ```
    {: .nolineno }

9. By default docker creates log files which can grow in size infinitely slowly taking away system resources. We correct this by adding log rotation. Either create or edit the file /etc/docker/daemon.json which is what controls daemon settings for docker. Add the following lines to setup log rotation with a max amount of 3 files at 50MB a piece before overwriting. We are also specifying that the log output should be in json. The JSON format annotates each line with its origin (stdout or stderr) and its timestamp. Each log file contains information about only one container.

    ```json
    {
      "log-driver": "json-file",
      "log-opts": {
        "max-size": "50m",
        "max-file": "3" 
      }
    }
    ```

## Usage

Coming soon.

## Cheat Sheet

![Docker commands](dockercheatsheet.png){: w="840" h="400" }






