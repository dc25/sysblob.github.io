---
title: A deep dive into Docker
image: docker.png
img_path: /images/
date: 2023-09-02
categories: [development]
tags: [docker,containers,devops]
pin: false
comments: true
---

Docker is a great straight forward way of using containerization. I'm a big fan, and use Docker to pretty much use Docker to run most of my lab. 

Refer to the Table of Contents if you are looking for something specific about Docker.

## What is Docker?

Will fill in later.

## Setup

> This is a How-to guide on setting up Docker on Ubuntu Linux. 
{: .prompt-info }

These commands are taken directly from Docker documentation and explained for your convenience.

1. Uninstall old docker versions to start fresh

    ```bash
    sudo apt-get remove docker docker-engine docker.io containerd runc
    ```
    {: .nolineno }

2. Add Docker’s GPG key to your machine. This acts as a signature for the docker repo and lets your machine know to trust it. It also provides encryption during the file transfer process.    

    ```bash
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
    ```
    {: .nolineno }

3. Next, use the following series of commands to send a script block to the terminal which points to the public GPG key that is now on the machine and tells the apt package manager to include the docker repository as a 3rd party trusted repo. 

    ```bash
    echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
      $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
    {: .nolineno }

4. Update the apt package index to include the new docker repo and install docker along with its engine and docker compose.

    ```bash
    sudo apt update
    ```
    {: .nolineno }
    ```bash
    sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
    ```
    {: .nolineno }

5. Verify docker is working as intended by running the test docker image.

    ```bash
    sudo docker run hello-world
    ```
    {: .nolineno }

6. Add your current logged in user to the Docker linux group which has permissions equivalent to root for editing file systems for your containers. (If this group is missing you can use sudo groupadd docker)

    ```bash
    sudo usermod -aG docker $USER
    ```
    {: .nolineno }

7. You can verify it worked by logging back in using “su - username” then trying to run docker without sudo now.

    ```bash
    docker run hello-world
    ```
    {: .nolineno }

8. On ubuntu Docker is added to start automatically but on other distributions you may need to use systemd the default system manager of most linux machines.

    ```bash
    sudo systemctl enable docker.service
    ```
    {: .nolineno }

    ```bash
    sudo systemctl enable containerd.service
    ```
    {: .nolineno }

9. By default docker creates log files which can grow in size infinitely slowly taking away system resources. We correct this by adding log rotation. Either create or edit the file /etc/docker/daemon.json which is what controls daemon settings for docker. Add the following lines to setup log rotation with a max amount of 3 files at 50MB a piece before overwriting. We are also specifying that the log output should be in json. The JSON format annotates each line with its origin (stdout or stderr) and its timestamp. Each log file contains information about only one container.

    ```json
    {
      "log-driver": "json-file",
      "log-opts": {
        "max-size": "50m",
        "max-file": "3" 
      }
    }
    ```

## Usage

Will fill in later.

## Cheat Sheet

![Docker commands](dockercheatsheet.png){: w="840" h="400" }






